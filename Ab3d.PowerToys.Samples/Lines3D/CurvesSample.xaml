<Page x:Class="Ab3d.PowerToys.Samples.Lines3D.CurvesSample"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      mc:Ignorable="d" 
      xmlns:cameras="clr-namespace:Ab3d.Cameras;assembly=Ab3d.PowerToys"
      xmlns:ab3d="clr-namespace:Ab3d.Controls;assembly=Ab3d.PowerToys"  
      xmlns:visuals="clr-namespace:Ab3d.Visuals;assembly=Ab3d.PowerToys"
      xmlns:common="clr-namespace:Ab3d.PowerToys.Samples.Common"
      Title="AllModelsSample"
      MinHeight="300"
      MinWidth="600">
    <Grid Name="MainGrid">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>
        <Border Name="RootBorder" Grid.Column="0">
            <Border.Background>
                <LinearGradientBrush StartPoint="0 0" EndPoint="0 1">
                    <GradientStop Offset="0" Color="#033C62"/>
                    <GradientStop Offset="1" Color="#01131F"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid>
                <Viewport3D Name="MainViewport" >
                    <visuals:ColoredAxisVisual3D Length="100" />
                    <ModelVisual3D x:Name="PositionsVisual"/>
                    <ModelVisual3D x:Name="CurvesVisual"/>
                </Viewport3D>
                <Canvas Name="OverlayCanvas" IsHitTestVisible="False" ClipToBounds="True"/>
            </Grid>
        </Border>


        <cameras:TargetPositionCamera Name="Camera1" Grid.Column="0"
                                      Heading="30" Attitude="-20" Bank="0" 
                                      Distance="400" 
                                      TargetPosition="0 0 0"
                                      ShowCameraLight="Always"
                                      TargetViewport3D="{Binding ElementName=MainViewport}"/>

        <ab3d:MouseCameraController Name="MouseCameraController1" Grid.Column="0" 
                                    RotateCameraConditions="LeftMouseButtonPressed"
                                    MoveCameraConditions="LeftMouseButtonPressed, ControlKey"
                                    EventsSourceElement="{Binding ElementName=RootBorder}"/>

        <ab3d:CameraControlPanel Grid.Column="0" VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="5" Width="225" Height="75" ShowMoveButtons="True"
                                 TargetCamera="{Binding ElementName=Camera1}"/>

        <TextBlock Grid.Column="0" FontWeight="Bold" FontSize="20" Foreground="Silver" Margin="10" VerticalAlignment="Top" HorizontalAlignment="Left" Text="3D curves sample"/>

        <Grid Grid.Column="1" Margin="10 0 0 0" Background="White">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Margin="10 5 10 0" Orientation="Vertical">
                <TextBlock FontSize="14" Margin="0 0 0 5" FontWeight="Bold" Text="Curve type:"/>

                <StackPanel Orientation="Horizontal" Margin="0 0 0 5">
                    <RadioButton Name="CurveThrougPointsRadioButton" IsChecked="True" Margin="0 0 5 0" GroupName="CurveType" Checked="CurveTypeRadioButton_Checked">Curve through points</RadioButton>
                    <common:InfoControl InfoText="Creates a Bezier curve that goes through specified points. The method computes the control points for the Bezier curves and uses curve scale that defines the curvature of the curve."/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0 0 0 5">
                    <RadioButton Name="BezierCurveRadioButton" GroupName="CurveType" Margin="0 0 5 0" Checked="CurveTypeRadioButton_Checked">Bezier Curve</RadioButton>
                    <common:InfoControl InfoText="Creates a Bezier curve where each curve segment is defined by 4 control point (2 for start and end of the curve and 2 for controlling the curvature)."/>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" Margin="0 0 0 5">
                    <RadioButton Name="BSplineRadioButton" GroupName="CurveType" Margin="0 0 5 0" Checked="CurveTypeRadioButton_Checked">B-Spline</RadioButton>
                    <common:InfoControl InfoText="Creates a B-Spline curve based on the specified control points and without using any weights."/>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" Margin="0 0 0 10">
                    <RadioButton Name="NURBSCurveRadioButton" GroupName="CurveType" Margin="0 0 5 0" Checked="CurveTypeRadioButton_Checked">NURBS Curve</RadioButton>
                    <common:InfoControl InfoText="NURBS curve is the same as B-Spline curve but is also has weighted control points."/>
                </StackPanel>

                <TextBlock Name="PositionTextBlock" Text="Position on curve (t = 0.50)"/>
                <Slider Name="PositionSlider" Minimum="0" Maximum="100" Value="50" TickFrequency="10" TickPlacement="TopLeft" ValueChanged="PositionSlider_ValueChanged"/>
                
                
                <TextBlock VerticalAlignment="Center" Text="Curve generation type:" FontWeight="Bold" Margin="0 10 0 2"/>
                
                <StackPanel Name="PositionsPerSegmentPanel" Orientation="Horizontal" Margin="0 5 0 0">
                    <RadioButton Name="PointsPerSegmentRadioButton" Content="Points per segment:" VerticalAlignment="Center" GroupName="GenerationType" Checked="OnGenerationTypeChanged" Unchecked="OnGenerationTypeChanged" />
                    <ComboBox Name="PositionsPerSegmentComboBox" Width="50" SelectedIndex="3" Margin="5 0" SelectionChanged="OnGenerationTypeChanged">
                        <ComboBoxItem>1</ComboBoxItem>
                        <ComboBoxItem>2</ComboBoxItem>
                        <ComboBoxItem>5</ComboBoxItem>
                        <ComboBoxItem>10</ComboBoxItem>
                        <ComboBoxItem>20</ComboBoxItem>
                        <ComboBoxItem>30</ComboBoxItem>
                    </ComboBox>
                    <common:InfoControl InfoText="When the curve is generated based on the points per segment,&#x0a;then the number of generated points if fixed regardless of the curvature.&#x0a;This method is very fast, but produce too many points along &#x0a;nearly straight sections and too few where the curve bends sharply.&#x0a;&#x0a;Final number of curve points is: (curve_points - 1) * points_per_segment + 1"/>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" Margin="0 5 0 0">
                    <RadioButton Name="AngleBasedRadioButton" Content="Angle based" IsChecked="True" GroupName="GenerationType" Margin="0 2 5 0" Checked="OnGenerationTypeChanged" Unchecked="OnGenerationTypeChanged" />
                    <common:InfoControl InfoText="Angle based curve generation generates the curve points by recursively&#x0a;subdividing each cubic segment until two tolerances are satisfied:&#x0a;`angleThresholdDegrees` limits how sharp the turn may be between consecutive chords,&#x0a;while `minSegmentLength` guarantees that no chord grows longer than the specified length."/>
                </StackPanel>
                
                <StackPanel Name="AngleBasedPanel1" Orientation="Horizontal" Margin="0 5 0 0">
                    <TextBlock Text="Angle Threshold (degrees):" Width="145" VerticalAlignment="Center"/>
                    <ComboBox Name="AngleThresholdComboBox" Width="50" SelectedIndex="4" Margin="5 0" SelectionChanged="OnGenerationTypeChanged">
                        <ComboBoxItem>0.2</ComboBoxItem>
                        <ComboBoxItem>0.5</ComboBoxItem>
                        <ComboBoxItem>1</ComboBoxItem>
                        <ComboBoxItem>2</ComboBoxItem>
                        <ComboBoxItem>5</ComboBoxItem>
                        <ComboBoxItem>10</ComboBoxItem>
                        <ComboBoxItem>20</ComboBoxItem>
                        <ComboBoxItem>30</ComboBoxItem>
                        <ComboBoxItem>90</ComboBoxItem>
                    </ComboBox>
                </StackPanel>
                <StackPanel Name="AngleBasedPanel2" Orientation="Horizontal" Margin="0 2 0 0">
                    <TextBlock Text="Min segment length:" Width="145" VerticalAlignment="Center"/>
                    <ComboBox Name="MinSegmentLengthComboBox" Width="50" SelectedIndex="1" Margin="5 0" SelectionChanged="OnGenerationTypeChanged">
                        <ComboBoxItem>1</ComboBoxItem>
                        <ComboBoxItem>2</ComboBoxItem>
                        <ComboBoxItem>5</ComboBoxItem>
                        <ComboBoxItem>10</ComboBoxItem>
                        <ComboBoxItem>20</ComboBoxItem>
                        <ComboBoxItem>50</ComboBoxItem>
                        <ComboBoxItem>100</ComboBoxItem>
                    </ComboBox>
                </StackPanel>
                
                <TextBlock Name="TotalPositionsTextBox" Text="Total positions: 0" FontWeight="Bold" Margin="0 10 0 0"/>
                <CheckBox Name="ShowPositionsCheckBox" Content="Show individual positions" IsChecked="True" Margin="0 5 0 0" Checked="OnGenerationTypeChanged" Unchecked="OnGenerationTypeChanged" ></CheckBox>
                
                <TextBlock Name="SchemaTextBox" Margin="0 10 0 0" Text="Control points (i x y z):"/>
            </StackPanel>
            
            <TextBox Name="PositionsTextBox" Grid.Row="1" AcceptsReturn="True" AcceptsTab="True" Margin="10 0 10 5" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" />
            
            <StackPanel Grid.Row="2" Margin="10 3 10 5" Orientation="Horizontal">
                <Button Name="CreateRandomPositionsButton" Content="Recreate positions" Width="130" Click="CreateRandomPositionsButton_Click"/>
                
                <TextBlock Text="Count:" Margin="10 0 3 0" VerticalAlignment="Center" />
                <ComboBox Name="PointsCountComboBox" SelectedIndex="2" SelectionChanged="PointsCountComboBox_OnSelectionChanged">
                    <ComboBoxItem>5</ComboBoxItem>
                    <ComboBoxItem>10</ComboBoxItem>
                    <ComboBoxItem>15</ComboBoxItem>
                    <ComboBoxItem>20</ComboBoxItem>
                </ComboBox>
            </StackPanel>
            
            

        </Grid>
    </Grid>
</Page>
